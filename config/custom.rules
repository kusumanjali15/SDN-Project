# Custom Suricata Rules for SDN Integration
# Only high-severity alerts (priority 1-2) trigger automatic blocking

# ===== ICMP Rules =====
# ICMP Flood Detection - triggers alert when 10+ pings in 5 seconds from same source
# type:both = alerts once when threshold is reached, then suppresses duplicates
alert icmp any any -> any any (msg:"ICMP Flood Attack Detected"; threshold: type both, track by_src, count 10, seconds 5; classtype:attempted-dos; sid:1000002; rev:4; priority:1;)

# ICMP Ping Sweep Detection - scanning multiple hosts
alert icmp any any -> any any (msg:"ICMP Ping Sweep Detected"; threshold: type both, track by_src, count 8, seconds 10; classtype:network-scan; sid:1000003; rev:3; priority:2;)

# ===== Port Scan Detection =====
# SYN Scan Detection (high severity)
alert tcp any any -> any any (msg:"Potential SYN Port Scan"; flags:S,12; threshold: type both, track by_src, count 20, seconds 10; classtype:attempted-recon; sid:1000010; rev:1; priority:1;)

# General Port Scan
alert tcp any any -> any any (msg:"Multiple Port Connections"; threshold: type threshold, track by_src, count 30, seconds 60; classtype:attempted-recon; sid:1000011; rev:1; priority:2;)

# ===== SSH Attacks =====
# SSH Brute Force (high severity)
alert tcp any any -> any 22 (msg:"SSH Brute Force Attack"; flags:S; threshold: type both, track by_src, count 10, seconds 60; classtype:attempted-admin; sid:1000020; rev:1; priority:1;)

# SSH Multiple Failed Logins
alert tcp any any -> any 22 (msg:"Multiple SSH Connection Attempts"; flow:to_server; threshold: type both, track by_src, count 5, seconds 30; classtype:attempted-admin; sid:1000021; rev:1; priority:2;)

# ===== HTTP Attacks =====
# SQL Injection Attempt (high severity)
alert http any any -> any any (msg:"Possible SQL Injection Attack"; flow:to_server; content:"union"; nocase; content:"select"; nocase; classtype:web-application-attack; sid:1000030; rev:1; priority:1;)

# XSS Attempt
alert http any any -> any any (msg:"Possible XSS Attack"; flow:to_server; content:"<script"; nocase; classtype:web-application-attack; sid:1000031; rev:1; priority:2;)

# Directory Traversal
alert http any any -> any any (msg:"Directory Traversal Attempt"; flow:to_server; content:"../"; classtype:web-application-attack; sid:1000032; rev:1; priority:2;)

# ===== DNS Attacks =====
# DNS Tunneling Detection
alert dns any any -> any any (msg:"Possible DNS Tunneling"; dns_query; content:"|00 10|"; depth:2; classtype:policy-violation; sid:1000040; rev:1; priority:2;)

# DNS Amplification Attack
alert udp any 53 -> any any (msg:"Possible DNS Amplification Attack"; threshold: type threshold, track by_src, count 50, seconds 10; classtype:attempted-dos; sid:1000041; rev:1; priority:1;)

# ===== DoS/DDoS Detection =====
# SYN Flood (high severity) - 30 SYN packets to same destination in 2 seconds
alert tcp any any -> any any (msg:"SYN Flood Attack Detected"; flags:S,12; threshold: type both, track by_dst, count 30, seconds 2; classtype:attempted-dos; sid:1000050; rev:2; priority:1;)

# UDP Flood - 50 UDP packets to same destination in 2 seconds
alert udp any any -> any any (msg:"UDP Flood Attack Detected"; threshold: type both, track by_dst, count 50, seconds 2; classtype:attempted-dos; sid:1000051; rev:2; priority:1;)

# Connection Flood - Many connections from single source
alert tcp any any -> any any (msg:"TCP Connection Flood Detected"; flags:S; threshold: type both, track by_src, count 40, seconds 3; classtype:attempted-dos; sid:1000052; rev:1; priority:1;)

# ===== Malware/Exploit Detection =====
# Suspicious Executable Download
alert http any any -> any any (msg:"Suspicious EXE Download"; flow:to_client; content:".exe"; nocase; classtype:trojan-activity; sid:1000060; rev:1; priority:2;)

# Suspicious PowerShell Activity
alert tcp any any -> any any (msg:"Suspicious PowerShell Activity"; content:"powershell"; nocase; content:"-enc"; nocase; classtype:trojan-activity; sid:1000061; rev:1; priority:1;)


